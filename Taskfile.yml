version: "3"

dotenv:
  - .env

tasks:
  default:
    silent: true
    cmd: task --list-all

  build:
    deps:
      - generate
    env:
      CGO_ENABLED: 0
    cmd: go build -o readflow main.go

  generate:
    cmd: go generate ./...

  test:
    cmd: go test ./...

  download-schemas:
    cmds:
      - "gql-sdl https://graphql.anilist.co -o schemas/anilist/schema.gql"
      - "gql-sdl https://api.hardcover.app/v1/graphql -o schemas/hardcover/schema.gql -H 'Authorization: {{ .HARDCOVER_TOKEN }}'"
    requires:
      vars: [HARDCOVER_TOKEN]
